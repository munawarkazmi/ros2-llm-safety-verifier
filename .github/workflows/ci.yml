# .github/workflows/ci.yml

name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          path: src/ros2_llm_safety_verifier

      - name: Build workspace
        run: |
          docker run --rm -v $(pwd):/ros2_ws/src/ros2_llm_safety_verifier \
            -w /ros2_ws ros:humble-ros-base \
            bash -c "
              apt-get update && apt-get install -y \
                python3-colcon-common-extensions python3-rosdep git && \
              rosdep init || true && rosdep update && \
              . /opt/ros/humble/setup.bash && \
              colcon build --packages-select ros2_llm_safety_verifier --cmake-args -DCMAKE_BUILD_TYPE=Release || echo 'No package yet – WIP'
            "

      - name: Run tests (placeholder OK – WIP)
        continue-on-error: true
        run: |
          docker run --rm -v $(pwd):/ros2_ws/src/ros2_llm_safety_verifier \
            -w /ros2_ws ros:humble-ros-base \
            bash -c "
              . /opt/ros/humble/setup.bash && \
              colcon test --packages-select ros2_llm_safety_verifier --event-handlers console_cohesion+ || echo 'No tests yet – coming soon' && \
              colcon test-result --verbose || true
            "
